{"version":3,"sources":["webpack:///./assets/js/theme/product.js","webpack:///./assets/js/theme/product/reviews.js","webpack:///./assets/js/theme/common/utils/safe-string.js","webpack:///./assets/js/theme/product/video-gallery.js"],"names":["Product","context","url","window","location","href","$reviewLink","$","$bulkPricingLink","reviewModal","modalFactory","onReady","validator","document","on","indexOf","history","replaceState","title","pathname","collapsibleFactory","this","productDetails","ProductDetails","BCData","product_attributes","setProductVariant","videoGallery","bulkPricingHandler","$reviewForm","classifyForm","length","review","Review","ModalEvents","opened","setupFocusTrap","registerValidation","ariaDescribeReviewInputs","performCheck","areAll","productReviewHandler","$form","find","each","_","input","$input","msgSpanId","attr","siblings","trigger","PageManager","nod","submit","tap","announceInputErrorMessage","$reviewsContent","$collapsible","initLinkBind","injectPaginationLink","collapseReviews","$content","hasClass","CollapsibleEvents","click","hash","$nextLink","$prevLink","add","selector","validate","errorMessage","safeString","reviewRating","reviewSubject","reviewComment","cb","val","forms","email","reviewEmail","str","DOMParser","parseFromString","body","textContent","VideoGallery","$element","$player","$videos","currentVideo","bindEvents","selectNewVideo","e","preventDefault","$target","currentTarget","id","data","$selectedThumb","setMainVideo","setActiveThumb","removeClass","addClass","bind","index","element","$el"],"mappings":"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","file":"theme-bundle.chunk.1.js","sourcesContent":["/*\r\n Import all product specific js\r\n */\r\nimport PageManager from './page-manager';\r\nimport Review from './product/reviews';\r\nimport collapsibleFactory from './common/collapsible';\r\nimport ProductDetails from './common/product-details';\r\nimport videoGallery from './product/video-gallery';\r\nimport { classifyForm } from './common/utils/form-utils';\r\nimport modalFactory, { ModalEvents } from './global/modal';\r\n\r\nexport default class Product extends PageManager {\r\n    constructor(context) {\r\n        super(context);\r\n        this.url = window.location.href;\r\n        this.$reviewLink = $('[data-reveal-id=\"modal-review-form\"]');\r\n        this.$bulkPricingLink = $('[data-reveal-id=\"modal-bulk-pricing\"]');\r\n        this.reviewModal = modalFactory('#modal-review-form')[0];\r\n    }\r\n\r\n    onReady() {\r\n        // Listen for foundation modal close events to sanitize URL after review.\r\n        $(document).on('close.fndtn.reveal', () => {\r\n            if (this.url.indexOf('#write_review') !== -1 && typeof window.history.replaceState === 'function') {\r\n                window.history.replaceState(null, document.title, window.location.pathname);\r\n            }\r\n        });\r\n\r\n        let validator;\r\n\r\n        // Init collapsible\r\n        collapsibleFactory();\r\n\r\n        this.productDetails = new ProductDetails($('.productView'), this.context, window.BCData.product_attributes);\r\n        this.productDetails.setProductVariant();\r\n\r\n        videoGallery();\r\n\r\n        this.bulkPricingHandler();\r\n\r\n        const $reviewForm = classifyForm('.writeReview-form');\r\n\r\n        if ($reviewForm.length === 0) return;\r\n\r\n        const review = new Review($reviewForm);\r\n\r\n        $(document).on(ModalEvents.opened, '#modal-review-form', () => this.reviewModal.setupFocusTrap());\r\n\r\n        $('body').on('click', '[data-reveal-id=\"modal-review-form\"]', () => {\r\n            validator = review.registerValidation(this.context);\r\n            this.ariaDescribeReviewInputs($reviewForm);\r\n        });\r\n\r\n        $reviewForm.on('submit', () => {\r\n            if (validator) {\r\n                validator.performCheck();\r\n                return validator.areAll('valid');\r\n            }\r\n\r\n            return false;\r\n        });\r\n\r\n        this.productReviewHandler();\r\n    }\r\n\r\n    ariaDescribeReviewInputs($form) {\r\n        $form.find('[data-input]').each((_, input) => {\r\n            const $input = $(input);\r\n            const msgSpanId = `${$input.attr('name')}-msg`;\r\n\r\n            $input.siblings('span').attr('id', msgSpanId);\r\n            $input.attr('aria-describedby', msgSpanId);\r\n        });\r\n    }\r\n\r\n    productReviewHandler() {\r\n        if (this.url.indexOf('#write_review') !== -1) {\r\n            this.$reviewLink.trigger('click');\r\n        }\r\n    }\r\n\r\n    bulkPricingHandler() {\r\n        if (this.url.indexOf('#bulk_pricing') !== -1) {\r\n            this.$bulkPricingLink.trigger('click');\r\n        }\r\n    }\r\n}\r\n","import nod from '../common/nod';\r\nimport { CollapsibleEvents } from '../common/collapsible';\r\nimport forms from '../common/models/forms';\r\nimport { safeString } from '../common/utils/safe-string';\r\nimport { announceInputErrorMessage } from '../common/utils/form-utils';\r\n\r\nexport default class {\r\n    constructor($reviewForm) {\r\n        this.validator = nod({\r\n            submit: $reviewForm.find('input[type=\"submit\"]'),\r\n            tap: announceInputErrorMessage,\r\n        });\r\n\r\n        this.$reviewsContent = $('#product-reviews');\r\n        this.$collapsible = $('[data-collapsible]', this.$reviewsContent);\r\n\r\n        this.initLinkBind();\r\n        this.injectPaginationLink();\r\n        this.collapseReviews();\r\n    }\r\n\r\n    /**\r\n     * On initial page load, the user clicks on \"(12 Reviews)\" link\r\n     * The browser jumps to the review page and should expand the reviews section\r\n     */\r\n    initLinkBind() {\r\n        const $content = $('#productReviews-content', this.$reviewsContent);\r\n\r\n        $('#productReview_link').on('click', () => {\r\n            $('.productView-reviewTabLink').trigger('click');\r\n            if (!$content.hasClass('is-open')) {\r\n                this.$collapsible.trigger(CollapsibleEvents.click);\r\n            }\r\n        });\r\n    }\r\n\r\n    collapseReviews() {\r\n        // We're in paginating state, do not collapse\r\n        if (window.location.hash && window.location.hash.indexOf('#product-reviews') === 0) {\r\n            return;\r\n        }\r\n\r\n        // force collapse on page load\r\n        this.$collapsible.trigger(CollapsibleEvents.click);\r\n    }\r\n\r\n    /**\r\n     * Inject ID into the pagination link\r\n     */\r\n    injectPaginationLink() {\r\n        const $nextLink = $('.pagination-item--next .pagination-link', this.$reviewsContent);\r\n        const $prevLink = $('.pagination-item--previous .pagination-link', this.$reviewsContent);\r\n\r\n        if ($nextLink.length) {\r\n            $nextLink.attr('href', `${$nextLink.attr('href')} #product-reviews`);\r\n        }\r\n\r\n        if ($prevLink.length) {\r\n            $prevLink.attr('href', `${$prevLink.attr('href')} #product-reviews`);\r\n        }\r\n    }\r\n\r\n    registerValidation(context) {\r\n        this.context = context;\r\n        this.validator.add([{\r\n            selector: '[name=\"revrating\"]',\r\n            validate: 'presence',\r\n            errorMessage: safeString(this.context.reviewRating),\r\n        }, {\r\n            selector: '[name=\"revtitle\"]',\r\n            validate: 'presence',\r\n            errorMessage: safeString(this.context.reviewSubject),\r\n        }, {\r\n            selector: '[name=\"revtext\"]',\r\n            validate: 'presence',\r\n            errorMessage: safeString(this.context.reviewComment),\r\n        }, {\r\n            selector: '.writeReview-form [name=\"email\"]',\r\n            validate: (cb, val) => {\r\n                const result = forms.email(val);\r\n                cb(result);\r\n            },\r\n            errorMessage: this.context.reviewEmail,\r\n        }]);\r\n\r\n        return this.validator;\r\n    }\r\n\r\n    validate() {\r\n        return this.validator.performCheck();\r\n    }\r\n}\r\n","/**\r\n * This function parses HTML entities in strings\r\n * @param str: String\r\n * @returns String\r\n*/\r\nexport const safeString = (str) => {\r\n    const d = new DOMParser();\r\n    return d.parseFromString(str, 'text/html').body.textContent;\r\n};\r\n","export class VideoGallery {\r\n    constructor($element) {\r\n        this.$player = $element.find('[data-video-player]');\r\n        this.$videos = $element.find('[data-video-item]');\r\n        this.currentVideo = {};\r\n        this.bindEvents();\r\n    }\r\n\r\n    selectNewVideo(e) {\r\n        e.preventDefault();\r\n\r\n        const $target = $(e.currentTarget);\r\n\r\n        this.currentVideo = {\r\n            id: $target.data('videoId'),\r\n            $selectedThumb: $target,\r\n        };\r\n\r\n        this.setMainVideo();\r\n        this.setActiveThumb();\r\n    }\r\n\r\n    setMainVideo() {\r\n        this.$player.attr('src', `//www.youtube.com/embed/${this.currentVideo.id}`);\r\n    }\r\n\r\n    setActiveThumb() {\r\n        this.$videos.removeClass('is-active');\r\n        this.currentVideo.$selectedThumb.addClass('is-active');\r\n    }\r\n\r\n    bindEvents() {\r\n        this.$videos.on('click', this.selectNewVideo.bind(this));\r\n    }\r\n}\r\n\r\nexport default function videoGallery() {\r\n    const pluginKey = 'video-gallery';\r\n    const $videoGallery = $(`[data-${pluginKey}]`);\r\n\r\n    $videoGallery.each((index, element) => {\r\n        const $el = $(element);\r\n        const isInitialized = $el.data(pluginKey) instanceof VideoGallery;\r\n\r\n        if (isInitialized) {\r\n            return;\r\n        }\r\n\r\n        $el.data(pluginKey, new VideoGallery($el));\r\n    });\r\n}\r\n"],"sourceRoot":""}